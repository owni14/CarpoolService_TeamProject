<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.kh.team.mappers.member">
	<insert id="insertMember">
		insert into member
			(m_id, m_name, m_pw, gender, m_company, m_dept, m_is_smoke, m_address, m_cellphone)
		values 
			(#{m_id}, #{m_name}, #{m_pw}, #{gender}, #{m_company}, #{m_dept}, #{m_is_smoke}, #{m_address}, #{m_cellphone})
	</insert>
	
	<select id="getMemberByIdAndPw" resultType="MemberVo">
		select * from member
		where m_id = #{m_id}
		and m_pw = #{m_pw}
	</select>
	
	<select id="admingetMemberList" resultType="MemberVo">
		select * from
			(select rownum rnum,a.* from
				(select * from member 
				<include refid="search"></include>
				order by m_id desc) a)
		where rnum between #{startRow} and #{endRow}
	</select>
	
	<!-- Driver List Query -->
	<select id="getDriverList" resultType="map">
		select d.driver_seq, m.m_id, m.m_address, m.m_company, m.m_name, m.m_dept, d.driver_depart_location, d.driver_depart_time 
		from driver d, member m
		where d.m_id = m.m_id
		and m.m_company = #{m_company}
	</select>
	
	<select id="adminGetCount" resultType="int">
		select count(*) from member
		<include refid="search"></include>
	</select>
	
	<update id="adminupdateBlackScore">
		update member set 
		m_blackpoint = m_blackpoint + #{black_score}
		where m_id = #{black_m_id}
	</update>
	
	<sql id="search">
		<if test = "searchType != null and keyword != null">
			<choose>
				<when test='searchType == "i"'>
					where m_id like '%' || #{keyword} || '%'
				</when>
				<when test='searchType == "n"'>
					where m_name like '%' || #{keyword} || '%'
				</when>
				<when test='searchType == "g"'>
					where gender like '%' || #{keyword} || '%'
				</when>
				<when test='searchType == "c"'>
					where m_company like '%' || #{keyword} || '%'
				</when>
				<when test='searchType == "a"'>
					where m_address like '%' || #{keyword} || '%'
				</when>
				<when test='searchType == "t"'>
					where m_cellphone like '%' || #{keyword} || '%'
				</when>
				<when test='searchType == "w"'>
					where m_is_drop like '%' || #{keyword} || '%'
				</when>
			</choose>
		</if>
	</sql>
	
	<select id="getDriverById" resultType="map">
		select m.m_id, m.m_name, m.gender, m.m_dept, d.driver_depart_location, d.driver_depart_time
		from member m, driver d
		where m.m_id = d.m_id
		and m.m_company = #{m_company}
		and m.m_id = #{m_id}
	</select>
	
	<select id="insertDriverLicense">
		insert into approve_driver (ad_seq, ad_license_img, m_id)
		values (seq_approve_driver.nextval, #{ad_license_img}, #{m_id})
	</select>
	
	<insert id="insertPassenger">
		insert into passenger (passenger_seq, m_id, passenger_depart_location, passenger_depart_time, driver_seq)
		values (seq_passenger.nextval, #{m_id}, #{boardLoct}, #{boardTime}, #{driver_seq})
	</insert>
	
</mapper>